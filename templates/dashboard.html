<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Top Navbar - Transparent with Tabs in Top Right -->
        <nav class="top-navbar" id="topNavbar">
            <div class="navbar-sports">
                {% for sport_key in selected_sports %}
                <a href="{{ url_for('sport_page', sport_key=sport_key) }}" class="navbar-sport-btn" data-sport="{{ sport_key }}">
                    <span class="sport-icon">{{ sports[sport_key].icon }}</span>
                    <span class="sport-name">{{ sports[sport_key].name }}</span>
                </a>
                {% endfor %}
                <a href="{{ url_for('calendar') }}" class="navbar-sport-btn calendar-btn">
                    <span class="sport-icon">üìÖ</span>
                    <span class="sport-name">Calendar</span>
                </a>
            </div>
            <div class="navbar-user">
                {% if username and not is_public %}
                <a href="{{ url_for('preferences') }}" class="user-menu-btn">
                    <span class="user-icon">üë§</span>
                    <span class="username">{{ username }}</span>
                </a>
                {% elif is_public %}
                <a href="{{ url_for('login') }}" class="login-btn">
                    <span class="login-icon">üîê</span>
                    <span>Login</span>
                </a>
                {% endif %}
            </div>
        </nav>
        
        <!-- Hero Section -->
        <div class="hero-section" id="heroSection">
            <div class="hero-background" id="heroBackground"></div>
            <div class="hero-overlay"></div>
            
            <!-- Hero Content -->
            <div class="hero-content-wrapper">
                <div class="hero-content" id="heroContent">
                    {% if timeline_events %}
                    {% set first_event = timeline_events[0] %}
                    <div class="hero-main">
                        <div class="hero-badges">
                            <div class="hero-badge">{{ sports[first_event.sport_key].name }}</div>
                            {% if first_event.get('is_completed') %}
                            <div class="hero-final-badge">FINAL</div>
                            {% elif first_event.get('is_live') %}
                            <div class="hero-live-badge">LIVE</div>
                            {% endif %}
                        </div>
                        
                        {# Matchup Title #}
                        <h1 class="hero-title" id="heroTitle">
                            {{ first_event.teams.home.name }} vs {{ first_event.teams.away.name }}
                        </h1>
                        
                        {# Team Info Row with Logos, Names, Records and Standings #}
                        <div class="hero-team-info-row" id="heroTeamInfo">
                            <div class="hero-team-block">
                                <div class="hero-team-header">
                                    {% if first_event.teams.home.logo %}
                                    <img src="{{ first_event.teams.home.logo }}" alt="{{ first_event.teams.home.name }}" class="hero-team-logo">
                                    {% endif %}
                                    <div class="hero-team-name">{{ first_event.teams.home.name }}</div>
                                </div>
                                {% if home_team_stats %}
                                <div class="hero-team-stats">
                                    <div class="hero-team-stat">
                                        <span>{{ home_team_stats.wins }}-{{ home_team_stats.losses }}</span>
                                        <span class="hero-stat-icon" onclick="showStandingsModal('{{ first_event.sport_key }}')">üìä</span>
                                    </div>
                                    <div class="hero-team-stat">
                                        <span>#{{ home_team_stats.rank }} in {{ home_team_stats.division }}</span>
                                        <span class="hero-stat-icon" onclick="showStandingsModal('{{ first_event.sport_key }}')">üìà</span>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="hero-team-block">
                                <div class="hero-team-header">
                                    {% if first_event.teams.away.logo %}
                                    <img src="{{ first_event.teams.away.logo }}" alt="{{ first_event.teams.away.name }}" class="hero-team-logo">
                                    {% endif %}
                                    <div class="hero-team-name">{{ first_event.teams.away.name }}</div>
                                </div>
                                {% if away_team_stats %}
                                <div class="hero-team-stats">
                                    <div class="hero-team-stat">
                                        <span>{{ away_team_stats.wins }}-{{ away_team_stats.losses }}</span>
                                        <span class="hero-stat-icon" onclick="showStandingsModal('{{ first_event.sport_key }}')">üìä</span>
                                    </div>
                                    <div class="hero-team-stat">
                                        <span>#{{ away_team_stats.rank }} in {{ away_team_stats.division }}</span>
                                        <span class="hero-stat-icon" onclick="showStandingsModal('{{ first_event.sport_key }}')">üìà</span>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if first_event.get('is_completed') and first_event.goals.home is not none and first_event.goals.away is not none %}
                        {# ==== COMPLETED GAME LAYOUT ==== #}
                        
                        {# Huge Centered Score #}
                        <div class="hero-score-large" id="heroScore">
                            <span class="hero-score-number {% if first_event.goals.home > first_event.goals.away %}winner{% endif %}">{{ first_event.goals.home }}</span>
                            <span class="hero-score-separator">-</span>
                            <span class="hero-score-number {% if first_event.goals.away > first_event.goals.home %}winner{% endif %}">{{ first_event.goals.away }}</span>
                        </div>
                        
                        {# Game Date #}
                        <div class="hero-meta" id="heroMeta">
                            <span class="hero-date">{{ first_event.fixture.date[:10] }}</span>
                        </div>
                        
                        {# Recap and Highlights Boxes #}
                        <div class="hero-content-boxes" id="heroContentBoxes">
                            <div class="hero-content-box">
                                <div class="hero-box-header" onclick="toggleContentBox(this)">
                                    <div class="hero-box-header-left">
                                        <span class="hero-box-icon">üìù</span>
                                        <span class="hero-box-title">Game Recap</span>
                                    </div>
                                    <span class="hero-box-expand-icon">‚ñº</span>
                                </div>
                                <div class="hero-box-content">
                                    {{ hero_data.get('recap', 'Game recap coming soon...') }}
                                </div>
                            </div>
                            <div class="hero-content-box">
                                <div class="hero-box-header" onclick="toggleContentBox(this)">
                                    <div class="hero-box-header-left">
                                        <span class="hero-box-icon">üé¨</span>
                                        <span class="hero-box-title">Highlights</span>
                                    </div>
                                    <span class="hero-box-expand-icon">‚ñº</span>
                                </div>
                                <div class="hero-box-content">
                                    <div class="hero-highlights-list">
                                        {% for highlight in hero_data.get('highlights', []) %}
                                        <div class="hero-highlight-item">
                                            <span class="hero-highlight-title">{{ highlight.title }}</span>
                                            <span class="hero-highlight-duration">{{ highlight.duration }}</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {% else %}
                        {# ==== UPCOMING/LIVE GAME LAYOUT ==== #}
                        
                        {# Game Info Bar #}
                        <div class="hero-game-info-bar" id="heroGameInfo">
                            <div class="hero-info-item">
                                <span class="hero-info-icon">üìÖ</span>
                                <span>{{ first_event.fixture.date[:10] }}</span>
                            </div>
                            <span class="hero-info-divider">|</span>
                            <div class="hero-info-item">
                                <span class="hero-info-icon">üïê</span>
                                <span>{{ hero_data.get('game_time', '7:30 PM PST') }}</span>
                            </div>
                            <span class="hero-info-divider">|</span>
                            <div class="hero-info-item">
                                <span class="hero-info-icon">üì∫</span>
                                <span>{{ hero_data.get('network', 'ESPN') }}</span>
                            </div>
                        </div>
                        
                        {# Preview and Team News Boxes #}
                        <div class="hero-content-boxes" id="heroContentBoxes">
                            <div class="hero-content-box">
                                <div class="hero-box-header" onclick="toggleContentBox(this)">
                                    <div class="hero-box-header-left">
                                        <span class="hero-box-icon">üì∞</span>
                                        <span class="hero-box-title">Game Preview</span>
                                    </div>
                                    <span class="hero-box-expand-icon">‚ñº</span>
                                </div>
                                <div class="hero-box-content">
                                    {{ hero_data.get('preview', 'Game preview coming soon...') }}
                                </div>
                            </div>
                            <div class="hero-content-box">
                                <div class="hero-box-header" onclick="toggleContentBox(this)">
                                    <div class="hero-box-header-left">
                                        <span class="hero-box-icon">üì∞</span>
                                        <span class="hero-box-title">Team News</span>
                                    </div>
                                    <span class="hero-box-expand-icon">‚ñº</span>
                                </div>
                                <div class="hero-box-content">
                                    {{ hero_data.get('team_news', 'No recent news available.') }}
                                </div>
                            </div>
                        </div>
                        
                        {% endif %}
                    </div>
                    {% else %}
                    <h1 class="hero-title">Welcome to Sports Dashboard</h1>
                    <p class="hero-description">Select your favorite sports to get started</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- First Row Cards - Fixed at Bottom -->
        <div class="cards-section cards-section-first" id="cardsSectionFirst">
            <div class="cards-header">
                <h2 class="cards-title">Up Next</h2>
            </div>
            
            <div class="cards-rail" id="cardsRailFirst">
                {% for event in first_row_events %}
                <div class="small-card" 
                     data-event-id="{{ event.fixture.id }}"
                     data-sport="{{ event.sport_key }}"
                     data-background-image="{{ event.background_image or '' }}"
                     {% if loop.first %}data-selected="true"{% endif %}>
                     
                     {% if event.get('is_favorite') %}
                     <div class="card-favorite-badge">‚ù§Ô∏è</div>
                     {% endif %}
                     
                     {% if event.get('is_live') %}
                     <div class="card-live-badge">LIVE</div>
                     {% endif %}
                     
                     <div class="small-card-image">
                         {% if event.background_image %}
                         <img src="{{ event.background_image }}" alt="{{ event.teams.home.name if event.teams.home.name else event.league.name }}" loading="lazy">
                         {% else %}
                         <div class="card-placeholder">{{ sports[event.sport_key].icon }}</div>
                         {% endif %}
                     </div>
                     
                     <div class="small-card-content">
                         <div class="card-sport-label">{{ sports[event.sport_key].name }}</div>
                         
                         {% if event.teams.home.name and event.teams.away.name %}
                         <div class="card-matchup">
                             <div class="card-team {% if event.get('is_favorite') and favorites.get(event.sport_key, '').lower() in event.teams.home.name.lower() %}highlighted{% endif %}">
                                 {% if event.teams.home.logo %}
                                 <img src="{{ event.teams.home.logo }}" alt="{{ event.teams.home.name }}" class="team-logo">
                                 {% endif %}
                                 <span class="card-team-abbrev">{{ get_abbrev(event.sport_key, event.teams.home.name) }}</span>
                             </div>
                             <div class="card-vs">vs</div>
                             <div class="card-team {% if event.get('is_favorite') and favorites.get(event.sport_key, '').lower() in event.teams.away.name.lower() %}highlighted{% endif %}">
                                 {% if event.teams.away.logo %}
                                 <img src="{{ event.teams.away.logo }}" alt="{{ event.teams.away.name }}" class="team-logo">
                                 {% endif %}
                                 <span class="card-team-abbrev">{{ get_abbrev(event.sport_key, event.teams.away.name) }}</span>
                             </div>
                         </div>
                         {% else %}
                         <div class="card-event-name">{{ event.league.name }}</div>
                         {% endif %}
                         
                         <div class="card-meta">
                             {% if event.get('is_live') %}
                             <span>{{ event.fixture.status.elapsed }}'</span>
                             <span>{{ event.goals.home }} - {{ event.goals.away }}</span>
                             {% elif event.get('is_completed') %}
                             <span>Final</span>
                             <span>{{ event.goals.home }} - {{ event.goals.away }}</span>
                             {% else %}
                             <span>{{ event.fixture.date[:10] }}</span>
                             {% endif %}
                         </div>
                     </div>
                 </div>
                 {% endfor %}
             </div>
         </div>
         
         <!-- Second Row Cards - Below Viewport -->
         {% if second_row_events %}
         <div class="cards-section cards-section-second" id="cardsSectionSecond">
             <div class="cards-header">
                 <h2 class="cards-title">More Events</h2>
             </div>
             
             <div class="cards-rail" id="cardsRailSecond">
                 {% for event in second_row_events %}
                 <div class="small-card" 
                      data-event-id="{{ event.fixture.id }}"
                      data-sport="{{ event.sport_key }}"
                      data-background-image="{{ event.background_image or '' }}">
                      
                      {% if event.get('is_favorite') %}
                      <div class="card-favorite-badge">‚ù§Ô∏è</div>
                      {% endif %}
                      
                      {% if event.get('is_live') %}
                      <div class="card-live-badge">LIVE</div>
                      {% endif %}
                      
                      <div class="small-card-image">
                          {% if event.background_image %}
                          <img src="{{ event.background_image }}" alt="{{ event.teams.home.name if event.teams.home.name else event.league.name }}" loading="lazy">
                          {% else %}
                          <div class="card-placeholder">{{ sports[event.sport_key].icon }}</div>
                          {% endif %}
                      </div>
                      
                      <div class="small-card-content">
                          <div class="card-sport-label">{{ sports[event.sport_key].name }}</div>
                          
                          {% if event.teams.home.name and event.teams.away.name %}
                          <div class="card-matchup">
                              <div class="card-team-abbrev {% if event.get('is_favorite') and favorites.get(event.sport_key, '').lower() in event.teams.home.name.lower() %}highlighted{% endif %}">
                                  {{ get_abbrev(event.sport_key, event.teams.home.name) }}
                              </div>
                              <div class="card-vs">vs</div>
                              <div class="card-team-abbrev {% if event.get('is_favorite') and favorites.get(event.sport_key, '').lower() in event.teams.away.name.lower() %}highlighted{% endif %}">
                                  {{ get_abbrev(event.sport_key, event.teams.away.name) }}
                              </div>
                          </div>
                          {% else %}
                          <div class="card-event-name">{{ event.league.name }}</div>
                          {% endif %}
                          
                          <div class="card-meta">
                              {% if event.get('is_live') %}
                              <span>{{ event.fixture.status.elapsed }}'</span>
                              <span>{{ event.goals.home }} - {{ event.goals.away }}</span>
                              {% elif event.get('is_completed') %}
                              <span>Final</span>
                              <span>{{ event.goals.home }} - {{ event.goals.away }}</span>
                              {% else %}
                              <span>{{ event.fixture.date[:10] }}</span>
                              {% endif %}
                          </div>
                      </div>
                  </div>
                  {% endfor %}
              </div>
          </div>
          {% endif %}
        
        <!-- Modals -->
        <div class="modal-overlay" id="modalOverlay">
            <div class="modal" id="modal">
                <button class="modal-close" id="modalClose">√ó</button>
                <div class="modal-content" id="modalContent"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal Data for JavaScript -->
    <script type="application/json" id="modalDataScript">
    {
        "stats": {{ hero_data.get('stats', {}) | tojson }},
        "standings": {{ hero_data.get('standings', []) | tojson }},
        "news": {{ hero_data.get('news', []) | tojson }}
    }
    </script>
    
    <!-- Events data for async image loading -->
    <script type="application/json" id="eventsData">
        {{ timeline_events | tojson }}
    </script>
    
    <!-- Standings Modal -->
    <div class="standings-modal" id="standingsModal">
        <div class="standings-modal-content">
            <div class="standings-modal-header">
                <h2 class="standings-modal-title" id="standingsModalTitle">Standings</h2>
                <span class="standings-modal-close" onclick="closeStandingsModal()">‚úï</span>
            </div>
            <div class="standings-divisions" id="standingsDivisions">
                <!-- Standings will be dynamically loaded here -->
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
